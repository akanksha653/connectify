{
    "sourceFile": "src/app/profile/page.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1752581326620,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752689296297,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -72,16 +72,10 @@\n             <p className=\"text-lg font-medium\">{userInfo.country}</p>\r\n           </div>\r\n         </div>\r\n \r\n-        <div className=\"mt-8 flex justify-center gap-4\">\r\n+        <div className=\"mt-8 flex justify-center\">\r\n           <button\r\n-            onClick={() => router.push(\"/\")}\r\n-            className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition\"\r\n-          >\r\n-            Edit Profile\r\n-          </button>\r\n-          <button\r\n             onClick={() => router.push(\"/anonymous\")}\r\n             className=\"px-4 py-2 bg-neutral-700 text-white rounded-lg hover:bg-neutral-800 transition\"\r\n           >\r\n             Back to Chat\r\n"
                },
                {
                    "date": 1758994960082,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,37 +1,56 @@\n \"use client\";\r\n \r\n import React, { useEffect, useState } from \"react\";\r\n import { useRouter } from \"next/navigation\";\r\n+import { useAuth } from \"../auth/authContext\";\r\n+import { ref, get } from \"firebase/database\";\r\n+import { database } from \"@/lib/firebaseConfig\";\r\n \r\n+interface UserInfo {\r\n+  name: string;\r\n+  age: number;\r\n+  country: string;\r\n+  avatar?: string;\r\n+}\r\n+\r\n export default function ProfilePage() {\r\n   const router = useRouter();\r\n-  const [userInfo, setUserInfo] = useState<{\r\n-    name: string;\r\n-    age: string;\r\n-    country: string;\r\n-    avatar?: string;\r\n-  } | null>(null);\r\n+  const { userId, loading } = useAuth();\r\n+  const [userInfo, setUserInfo] = useState<UserInfo | null>(null);\r\n \r\n   useEffect(() => {\r\n-    const stored = localStorage.getItem(\"user-info\");\r\n-    if (stored) {\r\n-      try {\r\n-        const parsed = JSON.parse(stored);\r\n-        if (parsed.name && parsed.age && parsed.country) {\r\n-          setUserInfo(parsed);\r\n-        } else {\r\n-          router.push(\"/\");\r\n+    if (!loading && !userId) {\r\n+      router.replace(\"/auth\");\r\n+      return;\r\n+    }\r\n+\r\n+    if (userId) {\r\n+      const fetchUser = async () => {\r\n+        try {\r\n+          const userRef = ref(database, `users/${userId}`);\r\n+          const snapshot = await get(userRef);\r\n+          if (snapshot.exists()) {\r\n+            setUserInfo(snapshot.val());\r\n+          } else {\r\n+            router.replace(\"/auth\");\r\n+          }\r\n+        } catch (err) {\r\n+          console.error(err);\r\n+          router.replace(\"/auth\");\r\n         }\r\n-      } catch {\r\n-        router.push(\"/\");\r\n-      }\r\n-    } else {\r\n-      router.push(\"/\");\r\n+      };\r\n+      fetchUser();\r\n     }\r\n-  }, [router]);\r\n+  }, [userId, loading, router]);\r\n \r\n-  if (!userInfo) return null;\r\n+  if (!userInfo) {\r\n+    return (\r\n+      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-neutral-50 to-neutral-200 dark:from-neutral-900 dark:to-neutral-800\">\r\n+        <p className=\"text-xl text-neutral-700 dark:text-neutral-300\">Loading profile...</p>\r\n+      </div>\r\n+    );\r\n+  }\r\n \r\n   return (\r\n     <main className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-neutral-50 to-neutral-200 dark:from-neutral-900 dark:to-neutral-800 px-4\">\r\n       <div className=\"bg-white dark:bg-neutral-800 rounded-2xl shadow-xl p-8 max-w-md w-full text-center border border-neutral-300 dark:border-neutral-700\">\r\n@@ -74,9 +93,9 @@\n         </div>\r\n \r\n         <div className=\"mt-8 flex justify-center\">\r\n           <button\r\n-            onClick={() => router.push(\"/anonymous\")}\r\n+            onClick={() => router.push(\"/home\")}\r\n             className=\"px-4 py-2 bg-neutral-700 text-white rounded-lg hover:bg-neutral-800 transition\"\r\n           >\r\n             Back to Chat\r\n           </button>\r\n"
                }
            ],
            "date": 1752581326620,
            "name": "Commit-0",
            "content": "\"use client\";\r\n\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nexport default function ProfilePage() {\r\n  const router = useRouter();\r\n  const [userInfo, setUserInfo] = useState<{\r\n    name: string;\r\n    age: string;\r\n    country: string;\r\n    avatar?: string;\r\n  } | null>(null);\r\n\r\n  useEffect(() => {\r\n    const stored = localStorage.getItem(\"user-info\");\r\n    if (stored) {\r\n      try {\r\n        const parsed = JSON.parse(stored);\r\n        if (parsed.name && parsed.age && parsed.country) {\r\n          setUserInfo(parsed);\r\n        } else {\r\n          router.push(\"/\");\r\n        }\r\n      } catch {\r\n        router.push(\"/\");\r\n      }\r\n    } else {\r\n      router.push(\"/\");\r\n    }\r\n  }, [router]);\r\n\r\n  if (!userInfo) return null;\r\n\r\n  return (\r\n    <main className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-neutral-50 to-neutral-200 dark:from-neutral-900 dark:to-neutral-800 px-4\">\r\n      <div className=\"bg-white dark:bg-neutral-800 rounded-2xl shadow-xl p-8 max-w-md w-full text-center border border-neutral-300 dark:border-neutral-700\">\r\n        <h1 className=\"text-2xl font-semibold mb-6\">Your Profile</h1>\r\n\r\n        {/* Avatar */}\r\n        <div className=\"flex justify-center\">\r\n          {userInfo.avatar ? (\r\n            userInfo.avatar.startsWith(\"data:\") || userInfo.avatar.startsWith(\"http\") ? (\r\n              <img\r\n                src={userInfo.avatar}\r\n                alt=\"Avatar\"\r\n                className=\"w-24 h-24 rounded-full object-cover border border-neutral-300 dark:border-neutral-700 mb-6\"\r\n              />\r\n            ) : (\r\n              <div className=\"w-24 h-24 rounded-full flex items-center justify-center text-5xl border border-neutral-300 dark:border-neutral-700 bg-neutral-100 dark:bg-neutral-700 mb-6\">\r\n                {userInfo.avatar}\r\n              </div>\r\n            )\r\n          ) : (\r\n            <div className=\"w-24 h-24 rounded-full flex items-center justify-center text-4xl border border-neutral-300 dark:border-neutral-700 bg-neutral-100 dark:bg-neutral-700 mb-6\">\r\n              ðŸ‘¤\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"text-left space-y-4\">\r\n          <div>\r\n            <p className=\"text-sm text-neutral-500\">Name</p>\r\n            <p className=\"text-lg font-medium\">{userInfo.name}</p>\r\n          </div>\r\n          <div>\r\n            <p className=\"text-sm text-neutral-500\">Age</p>\r\n            <p className=\"text-lg font-medium\">{userInfo.age}</p>\r\n          </div>\r\n          <div>\r\n            <p className=\"text-sm text-neutral-500\">Country</p>\r\n            <p className=\"text-lg font-medium\">{userInfo.country}</p>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"mt-8 flex justify-center gap-4\">\r\n          <button\r\n            onClick={() => router.push(\"/\")}\r\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition\"\r\n          >\r\n            Edit Profile\r\n          </button>\r\n          <button\r\n            onClick={() => router.push(\"/anonymous\")}\r\n            className=\"px-4 py-2 bg-neutral-700 text-white rounded-lg hover:bg-neutral-800 transition\"\r\n          >\r\n            Back to Chat\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n"
        }
    ]
}