{
    "sourceFile": "src/app/auth/login/page.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1758994432394,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1759339062895,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,12 +22,12 @@\n     try {\r\n       setLoading(true);\r\n       const uid = await loginUser(email, password);\r\n       setUserId(uid);\r\n-      router.push(\"/home\"); // Redirect to home after login\r\n-    } catch (err) {\r\n+      router.replace(\"/home\"); // ✅ replace instead of push\r\n+    } catch (err: any) {\r\n       console.error(err);\r\n-      alert(\"Login error: \" + err);\r\n+      alert(\"Login error: \" + err.message || err);\r\n     } finally {\r\n       setLoading(false);\r\n     }\r\n   };\r\n"
                },
                {
                    "date": 1759341923884,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,8 +3,10 @@\n import { useState } from \"react\";\r\n import { useRouter } from \"next/navigation\";\r\n import { loginUser } from \"../firebaseAuth\";\r\n import { useAuth } from \"../authContext\";\r\n+import { ref, get } from \"firebase/database\";\r\n+import { database } from \"@/lib/firebaseConfig\";\r\n \r\n export default function LoginPage() {\r\n   const { setUserId } = useAuth();\r\n   const router = useRouter();\r\n@@ -20,14 +22,31 @@\n     }\r\n \r\n     try {\r\n       setLoading(true);\r\n+\r\n+      // 1️⃣ Login via Firebase Auth\r\n       const uid = await loginUser(email, password);\r\n+\r\n+      // 2️⃣ Fetch user info from Realtime Database\r\n+      const userRef = ref(database, `users/${uid}`);\r\n+      const snapshot = await get(userRef);\r\n+      if (!snapshot.exists()) {\r\n+        alert(\"User data not found. Please register first.\");\r\n+        setLoading(false);\r\n+        return;\r\n+      }\r\n+\r\n+      // 3️⃣ Store UID in context and user info in localStorage\r\n+      const userData = snapshot.val();\r\n       setUserId(uid);\r\n-      router.replace(\"/home\"); // ✅ replace instead of push\r\n+      localStorage.setItem(\"user-info\", JSON.stringify(userData));\r\n+\r\n+      // 4️⃣ Redirect to /home\r\n+      router.replace(\"/home\");\r\n     } catch (err: any) {\r\n-      console.error(err);\r\n-      alert(\"Login error: \" + err.message || err);\r\n+      console.error(\"Login Error:\", err);\r\n+      alert(\"Login error: \" + (err.message || err));\r\n     } finally {\r\n       setLoading(false);\r\n     }\r\n   };\r\n"
                }
            ],
            "date": 1758994432394,
            "name": "Commit-0",
            "content": "\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { loginUser } from \"../firebaseAuth\";\r\nimport { useAuth } from \"../authContext\";\r\n\r\nexport default function LoginPage() {\r\n  const { setUserId } = useAuth();\r\n  const router = useRouter();\r\n\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const handleLogin = async () => {\r\n    if (!email || !password) {\r\n      alert(\"Please enter email and password\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      const uid = await loginUser(email, password);\r\n      setUserId(uid);\r\n      router.push(\"/home\"); // Redirect to home after login\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert(\"Login error: \" + err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center justify-center min-h-screen space-y-4 px-4\">\r\n      <h1 className=\"text-2xl font-bold mb-4\">Login</h1>\r\n\r\n      <input\r\n        type=\"email\"\r\n        placeholder=\"Email\"\r\n        value={email}\r\n        onChange={(e) => setEmail(e.target.value)}\r\n        className=\"w-full max-w-md px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n      />\r\n      <input\r\n        type=\"password\"\r\n        placeholder=\"Password\"\r\n        value={password}\r\n        onChange={(e) => setPassword(e.target.value)}\r\n        className=\"w-full max-w-md px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n      />\r\n\r\n      <button\r\n        onClick={handleLogin}\r\n        disabled={loading}\r\n        className=\"w-full max-w-md bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-md shadow-md transition\"\r\n      >\r\n        {loading ? \"Logging in...\" : \"Login\"}\r\n      </button>\r\n\r\n      <p className=\"text-sm text-gray-600 mt-2\">\r\n        Don’t have an account?{\" \"}\r\n        <a href=\"/auth/register\" className=\"text-blue-600 hover:underline\">\r\n          Register here\r\n        </a>\r\n      </p>\r\n    </div>\r\n  );\r\n}\r\n"
        }
    ]
}