{
    "sourceFile": "features/anonymousChat/page.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1758996553682,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1758996587502,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,26 +2,39 @@\n \r\n import React, { useEffect, useState } from \"react\";\r\n import { useRouter } from \"next/navigation\";\r\n import AnonymousChatRoom from \"./components/AnonymousChatRoom\";\r\n-import { auth } from \"../../lib/firebaseConfig\"; // your existing config\r\n+import { auth, db } from \"../../lib/firebaseConfig\";\r\n import { onAuthStateChanged } from \"firebase/auth\";\r\n+import { doc, getDoc } from \"firebase/firestore\";\r\n \r\n export default function AnonymousChatPage() {\r\n   const [userInfo, setUserInfo] = useState<any>(null);\r\n   const router = useRouter();\r\n \r\n   useEffect(() => {\r\n-    const unsubscribe = onAuthStateChanged(auth, (user) => {\r\n+    const unsubscribe = onAuthStateChanged(auth, async (user) => {\r\n       if (user) {\r\n-        // You can also fetch additional user info from Firestore if needed\r\n-        setUserInfo({\r\n-          uid: user.uid,\r\n-          name: user.displayName || \"Anonymous\",\r\n-          email: user.email,\r\n-        });\r\n+        // Fetch additional profile data from Firestore\r\n+        const docRef = doc(db, \"users\", user.uid);\r\n+        const docSnap = await getDoc(docRef);\r\n+\r\n+        if (docSnap.exists()) {\r\n+          const data = docSnap.data();\r\n+          setUserInfo({\r\n+            uid: user.uid,\r\n+            name: data.name || user.displayName || \"Anonymous\",\r\n+            age: data.age || \"\",\r\n+            gender: data.gender || \"\",\r\n+            country: data.country || \"\",\r\n+            email: user.email,\r\n+          });\r\n+        } else {\r\n+          // Firestore doc missing: redirect to profile setup page\r\n+          router.push(\"/profile-setup\");\r\n+        }\r\n       } else {\r\n-        router.push(\"/auth/login\"); // redirect to login if not logged in\r\n+        router.push(\"/auth/login\");\r\n       }\r\n     });\r\n \r\n     return () => unsubscribe();\r\n"
                },
                {
                    "date": 1759147633303,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,40 +1,49 @@\n \"use client\";\r\n \r\n import React, { useEffect, useState } from \"react\";\r\n import { useRouter } from \"next/navigation\";\r\n-import AnonymousChatRoom from \"./components/AnonymousChatRoom\";\r\n+import AnonymousChatRoom, {\r\n+  UserInfo, // <-- import the type from AnonymousChatRoom for consistency\r\n+} from \"./components/AnonymousChatRoom\";\r\n import { auth, db } from \"../../lib/firebaseConfig\";\r\n import { onAuthStateChanged } from \"firebase/auth\";\r\n import { doc, getDoc } from \"firebase/firestore\";\r\n \r\n export default function AnonymousChatPage() {\r\n-  const [userInfo, setUserInfo] = useState<any>(null);\r\n+  const [userInfo, setUserInfo] = useState<UserInfo | null>(null);\r\n   const router = useRouter();\r\n \r\n   useEffect(() => {\r\n+    // listen for login state changes\r\n     const unsubscribe = onAuthStateChanged(auth, async (user) => {\r\n-      if (user) {\r\n-        // Fetch additional profile data from Firestore\r\n+      if (!user) {\r\n+        router.replace(\"/auth/login\");\r\n+        return;\r\n+      }\r\n+\r\n+      try {\r\n         const docRef = doc(db, \"users\", user.uid);\r\n         const docSnap = await getDoc(docRef);\r\n \r\n-        if (docSnap.exists()) {\r\n-          const data = docSnap.data();\r\n-          setUserInfo({\r\n-            uid: user.uid,\r\n-            name: data.name || user.displayName || \"Anonymous\",\r\n-            age: data.age || \"\",\r\n-            gender: data.gender || \"\",\r\n-            country: data.country || \"\",\r\n-            email: user.email,\r\n-          });\r\n-        } else {\r\n-          // Firestore doc missing: redirect to profile setup page\r\n-          router.push(\"/profile-setup\");\r\n+        if (!docSnap.exists()) {\r\n+          // if profile not set up yet\r\n+          router.replace(\"/profile-setup\");\r\n+          return;\r\n         }\r\n-      } else {\r\n-        router.push(\"/auth/login\");\r\n+\r\n+        const data = docSnap.data();\r\n+        setUserInfo({\r\n+          uid: user.uid,\r\n+          name: data.name || user.displayName || \"Anonymous\",\r\n+          age: data.age || \"\",\r\n+          gender: data.gender || \"\",\r\n+          country: data.country || \"\",\r\n+          email: user.email || \"\",\r\n+        });\r\n+      } catch (err) {\r\n+        console.error(\"ðŸ”¥ Failed to fetch user profile:\", err);\r\n+        router.replace(\"/auth/login\");\r\n       }\r\n     });\r\n \r\n     return () => unsubscribe();\r\n@@ -43,9 +52,9 @@\n   if (!userInfo) {\r\n     return (\r\n       <div className=\"min-h-screen flex items-center justify-center bg-neutral-100 dark:bg-neutral-900\">\r\n         <p className=\"text-lg text-neutral-700 dark:text-neutral-300\">\r\n-          Loading your profile...\r\n+          Loading your profileâ€¦\r\n         </p>\r\n       </div>\r\n     );\r\n   }\r\n"
                },
                {
                    "date": 1759330648396,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,63 +0,0 @@\n-\"use client\";\r\n-\r\n-import React, { useEffect, useState } from \"react\";\r\n-import { useRouter } from \"next/navigation\";\r\n-import AnonymousChatRoom, {\r\n-  UserInfo, // <-- import the type from AnonymousChatRoom for consistency\r\n-} from \"./components/AnonymousChatRoom\";\r\n-import { auth, db } from \"../../lib/firebaseConfig\";\r\n-import { onAuthStateChanged } from \"firebase/auth\";\r\n-import { doc, getDoc } from \"firebase/firestore\";\r\n-\r\n-export default function AnonymousChatPage() {\r\n-  const [userInfo, setUserInfo] = useState<UserInfo | null>(null);\r\n-  const router = useRouter();\r\n-\r\n-  useEffect(() => {\r\n-    // listen for login state changes\r\n-    const unsubscribe = onAuthStateChanged(auth, async (user) => {\r\n-      if (!user) {\r\n-        router.replace(\"/auth/login\");\r\n-        return;\r\n-      }\r\n-\r\n-      try {\r\n-        const docRef = doc(db, \"users\", user.uid);\r\n-        const docSnap = await getDoc(docRef);\r\n-\r\n-        if (!docSnap.exists()) {\r\n-          // if profile not set up yet\r\n-          router.replace(\"/profile-setup\");\r\n-          return;\r\n-        }\r\n-\r\n-        const data = docSnap.data();\r\n-        setUserInfo({\r\n-          uid: user.uid,\r\n-          name: data.name || user.displayName || \"Anonymous\",\r\n-          age: data.age || \"\",\r\n-          gender: data.gender || \"\",\r\n-          country: data.country || \"\",\r\n-          email: user.email || \"\",\r\n-        });\r\n-      } catch (err) {\r\n-        console.error(\"ðŸ”¥ Failed to fetch user profile:\", err);\r\n-        router.replace(\"/auth/login\");\r\n-      }\r\n-    });\r\n-\r\n-    return () => unsubscribe();\r\n-  }, [router]);\r\n-\r\n-  if (!userInfo) {\r\n-    return (\r\n-      <div className=\"min-h-screen flex items-center justify-center bg-neutral-100 dark:bg-neutral-900\">\r\n-        <p className=\"text-lg text-neutral-700 dark:text-neutral-300\">\r\n-          Loading your profileâ€¦\r\n-        </p>\r\n-      </div>\r\n-    );\r\n-  }\r\n-\r\n-  return <AnonymousChatRoom userInfo={userInfo} />;\r\n-}\r\n\\ No newline at end of file\n"
                }
            ],
            "date": 1758996553682,
            "name": "Commit-0",
            "content": "\"use client\";\r\n\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport AnonymousChatRoom from \"./components/AnonymousChatRoom\";\r\nimport { auth } from \"../../lib/firebaseConfig\"; // your existing config\r\nimport { onAuthStateChanged } from \"firebase/auth\";\r\n\r\nexport default function AnonymousChatPage() {\r\n  const [userInfo, setUserInfo] = useState<any>(null);\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    const unsubscribe = onAuthStateChanged(auth, (user) => {\r\n      if (user) {\r\n        // You can also fetch additional user info from Firestore if needed\r\n        setUserInfo({\r\n          uid: user.uid,\r\n          name: user.displayName || \"Anonymous\",\r\n          email: user.email,\r\n        });\r\n      } else {\r\n        router.push(\"/auth/login\"); // redirect to login if not logged in\r\n      }\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, [router]);\r\n\r\n  if (!userInfo) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-neutral-100 dark:bg-neutral-900\">\r\n        <p className=\"text-lg text-neutral-700 dark:text-neutral-300\">\r\n          Loading your profile...\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return <AnonymousChatRoom userInfo={userInfo} />;\r\n}\r\n"
        }
    ]
}